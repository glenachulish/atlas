{
  "id": "atlas-test",
  "title": { 
    "en": "Atlas Points of Interest",
    "gd": "Atlas Puingean √ôidh"
  },
  "description": { 
    "en": "Add points of interest with name, description, photo, URL, and tags. <a href='https://glenachulish.github.io/atlas/contribute_en.html' target='_blank' rel='noopener'>View instructions</a>",
    "gd": "Cuir puingean √πidh ris le ainm, tuairisgeul, dealbh, URL, agus tagaichean. <a href='https://glenachulish.github.io/atlas/contribute_gd.html' target='_blank' rel='noopener'>Seall sti√πireadh</a>"
  },
  "welcomeMessage": { 
    "en": "üëã Tap + to add a point of interest. <a href='https://glenachulish.github.io/atlas/contribute_en.html' target='_blank' rel='noopener'>Need help?</a>",
    "gd": "üëã Thoir gnogag air + gus puing √πidh a chur ris. <a href='https://glenachulish.github.io/atlas/contribute_gd.html' target='_blank' rel='noopener'>A bheil feum air taic?</a>"
  },
  "icon": "https://glenachulish.github.io/atlas/icons/atlas_castle.svg",
  "startWithLayer": "poi",
  "enableMoreQuests": true,
  "enableAddNewPoints": true,
  "enableGeolocation": true,
  "enableLayers": true,
  "enableSearch": true,
  "enableUserBadge": true,
  "enableShareScreen": true,
  "enableMorePrivacy": false,
  "backgroundLayers": [
    {
      "id": "osm-default",
      "name": { "en": "OpenStreetMap" },
      "url": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      "attribution": "¬© OpenStreetMap contributors",
      "maxZoom": 19
    }
  ],
  "layers": [
    {
      "id": "poi",
      "name": { "en": "Point of Interest" },
      "source": { "osmTags": "atlas_poi=yes", "geometry": "point" },
      "title": { "en": "{name}" },
      "allowAdd": true,
      "allowMove": true,
      "pointRendering": [
        {
          "location": ["point"],
          "icon": "https://glenachulish.github.io/atlas/icons/atlas_castle.svg",
          "iconSize": "40,40",
          "anchor": "center",
          "label": "{name}"
        }
      ],
      "lineRendering": [
        { "color": "#00000000", "width": 0 }
      ],
      "areaRendering": [
        { "fillColor": "#00000000", "strokeColor": "#00000000", "strokeWidth": 0 }
      ],
      "tagRenderings": [
        {
          "id": "poi-name",
          "question": { 
            "en": "What is this place called?",
            "gd": "D√® an t-ainm a th' air an √†ite seo?"
          },
          "freeform": { "key": "name" },
          "render": { 
            "en": "<strong>Name:</strong> {name}",
            "gd": "<strong>Ainm:</strong> {name}"
          }
        },
        {
          "id": "poi-description",
          "question": { 
            "en": "Add a description (up to 1000 words)",
            "gd": "Cuir tuairisgeul ris (suas ri 1000 facal)"
          },
          "freeform": { 
            "key": "description",
            "type": "text"
          },
          "questionHint": {
            "en": "You can write up to 1000 words describing this location, its history, significance, or any other relevant information.",
            "gd": "Faodaidh tu suas ri 1000 facal a sgr√¨obhadh a' toirt cunntas air an √†ite seo, an eachdraidh, an cudromachd, no fiosrachadh sam bith eile a tha buntainneach."
          },
          "render": { 
            "en": "<strong>Description:</strong><br/>{description}",
            "gd": "<strong>Tuairisgeul:</strong><br/>{description}"
          }
        },
        {
          "builtin": "images"
        },
        {
          "id": "poi-wikimedia-search",
          "question": {
            "en": "Search and add Wikimedia Commons images",
            "gd": "Lorg agus cuir dealbhan Wikimedia Commons ris"
          },
          "render": {
            "en": `<div class="wikimedia-search">
              <h4>Wikimedia Commons Images</h4>
              <div style="margin: 10px 0;">
                <input type="text" id="wikimedia-search-input" placeholder="Search for images (e.g., Scottish castle, Highland landscape)" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                <button onclick="searchWikimedia()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px;">Search Wikimedia</button>
              </div>
              <div id="wikimedia-results" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;"></div>
              <div id="selected-wikimedia" style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                <strong>Selected Images:</strong>
                <div id="selected-images-list"></div>
              </div>
              <input type="hidden" id="wikimedia_commons" name="wikimedia_commons" value="{wikimedia_commons}">
            </div>
            <script>
              let selectedWikimediaImages = [];
              
              function searchWikimedia() {
                const query = document.getElementById('wikimedia-search-input').value;
                const resultsDiv = document.getElementById('wikimedia-results');
                resultsDiv.innerHTML = '<p>Searching...</p>';
                
                // Simple Wikimedia API search
                fetch('https://commons.wikimedia.org/w/api.php?action=query&format=json&generator=search&gsrnamespace=6&gsrsearch=' + encodeURIComponent(query) + '&gsrlimit=12&prop=imageinfo&iiprop=url&iiurlwidth=200&origin=*')
                  .then(response => response.json())
                  .then(data => {
                    resultsDiv.innerHTML = '';
                    if (data.query && data.query.pages) {
                      Object.values(data.query.pages).forEach(page => {
                        const thumbUrl = page.imageinfo[0].thumburl;
                        const fullUrl = page.imageinfo[0].url;
                        const title = page.title;
                        
                        const imgDiv = document.createElement('div');
                        imgDiv.style.cursor = 'pointer';
                        imgDiv.style.textAlign = 'center';
                        imgDiv.onclick = () => selectWikimediaImage(title, thumbUrl);
                        imgDiv.innerHTML = '
                          <img src="' + thumbUrl + '" style="width: 100%; height: 100px; object-fit: cover; border-radius: 4px;">
                          <div style="font-size: 12px; margin-top: 5px; overflow: hidden; text-overflow: ellipsis;">' + title.replace('File:', '') + '</div>
                        ';
                        resultsDiv.appendChild(imgDiv);
                      });
                    } else {
                      resultsDiv.innerHTML = '<p>No images found. Try a different search term.</p>';
                    }
                  })
                  .catch(error => {
                    resultsDiv.innerHTML = '<p>Error searching. You can manually enter file names below.</p>';
                  });
              }
              
              function selectWikimediaImage(title, thumbUrl) {
                if (!selectedWikimediaImages.includes(title)) {
                  selectedWikimediaImages.push(title);
                  updateSelectedImagesList();
                  document.getElementById('wikimedia_commons').value = selectedWikimediaImages.join(', ');
                  
                  // Trigger MapComplete save
                  const event = new Event('change', { bubbles: true });
                  document.getElementById('wikimedia_commons').dispatchEvent(event);
                }
              }
              
              function removeWikimediaImage(index) {
                selectedWikimediaImages.splice(index, 1);
                updateSelectedImagesList();
                document.getElementById('wikimedia_commons').value = selectedWikimediaImages.join(', ');
                
                // Trigger MapComplete save
                const event = new Event('change', { bubbles: true });
                document.getElementById('wikimedia_commons').dispatchEvent(event);
              }
              
              function updateSelectedImagesList() {
                const listDiv = document.getElementById('selected-images-list');
                listDiv.innerHTML = '';
                
                selectedWikimediaImages.forEach((image, index) => {
                  const imgItem = document.createElement('div');
                  imgItem.style.display = 'flex';
                  imgItem.style.alignItems = 'center';
                  imgItem.style.margin = '5px 0';
                  imgItem.style.padding = '5px';
                  imgItem.style.background = 'white';
                  imgItem.style.borderRadius = '4px';
                  imgItem.innerHTML = '
                    <span style="flex: 1; font-size: 12px;">' + image.replace('File:', '') + '</span>
                    <button onclick="removeWikimediaImage(' + index + ')" style="margin-left: 10px; padding: 2px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; font-size: 12px;">Remove</button>
                  ';
                  listDiv.appendChild(imgItem);
                });
                
                if (selectedWikimediaImages.length === 0) {
                  listDiv.innerHTML = '<p style="margin: 0; font-style: italic; color: #666;">No images selected yet</p>';
                }
              }
              
              // Load existing images on render
              if ('{wikimedia_commons}' && '{wikimedia_commons}' !== 'undefined') {
                selectedWikimediaImages = '{wikimedia_commons}'.split(',').map(img => img.trim()).filter(img => img);
                updateSelectedImagesList();
              }
            </script>`,
            "gd": `<div class="wikimedia-search">
              <h4>Dealbhan Wikimedia Commons</h4>
              <div style="margin: 10px 0;">
                <input type="text" id="wikimedia-search-input" placeholder="Lorg dealbhan (m.e., caisteal Albannach, cruth-t√¨re G√†idhealach)" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                <button onclick="searchWikimedia()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px;">Lorg Wikimedia</button>
              </div>
              <div id="wikimedia-results" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;"></div>
              <div id="selected-wikimedia" style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                <strong>Dealbhan taghte:</strong>
                <div id="selected-images-list"></div>
              </div>
              <input type="hidden" id="wikimedia_commons" name="wikimedia_commons" value="{wikimedia_commons}">
            </div>
            <script>
              let selectedWikimediaImages = [];
              
              function searchWikimedia() {
                const query = document.getElementById('wikimedia-search-input').value;
                const resultsDiv = document.getElementById('wikimedia-results');
                resultsDiv.innerHTML = '<p>A\' lorg...</p>';
                
                // Simple Wikimedia API search
                fetch('https://commons.wikimedia.org/w/api.php?action=query&format=json&generator=search&gsrnamespace=6&gsrsearch=' + encodeURIComponent(query) + '&gsrlimit=12&prop=imageinfo&iiprop=url&iiurlwidth=200&origin=*')
                  .then(response => response.json())
                  .then(data => {
                    resultsDiv.innerHTML = '';
                    if (data.query && data.query.pages) {
                      Object.values(data.query.pages).forEach(page => {
                        const thumbUrl = page.imageinfo[0].thumburl;
                        const fullUrl = page.imageinfo[0].url;
                        const title = page.title;
                        
                        const imgDiv = document.createElement('div');
                        imgDiv.style.cursor = 'pointer';
                        imgDiv.style.textAlign = 'center';
                        imgDiv.onclick = () => selectWikimediaImage(title, thumbUrl);
                        imgDiv.innerHTML = '
                          <img src="' + thumbUrl + '" style="width: 100%; height: 100px; object-fit: cover; border-radius: 4px;">
                          <div style="font-size: 12px; margin-top: 5px; overflow: hidden; text-overflow: ellipsis;">' + title.replace('File:', '') + '</div>
                        ';
                        resultsDiv.appendChild(imgDiv);
                      });
                    } else {
                      resultsDiv.innerHTML = '<p>Cha deach dealbh a lorg. Feuch facal-lorg eile.</p>';
                    }
                  })
                  .catch(error => {
                    resultsDiv.innerHTML = '<p>Mearachd a\' lorg. Faodaidh tu ainmean faidhle a chur a-steach le l√†mh.</p>';
                  });
              }
              
              function selectWikimediaImage(title, thumbUrl) {
                if (!selectedWikimediaImages.includes(title)) {
                  selectedWikimediaImages.push(title);
                  updateSelectedImagesList();
                  document.getElementById('wikimedia_commons').value = selectedWikimediaImages.join(', ');
                  
                  // Trigger MapComplete save
                  const event = new Event('change', { bubbles: true });
                  document.getElementById('wikimedia_commons').dispatchEvent(event);
                }
              }
              
              function removeWikimediaImage(index) {
                selectedWikimediaImages.splice(index, 1);
                updateSelectedImagesList();
                document.getElementById('wikimedia_commons').value = selectedWikimediaImages.join(', ');
                
                // Trigger MapComplete save
                const event = new Event('change', { bubbles: true });
                document.getElementById('wikimedia_commons').dispatchEvent(event);
              }
              
              function updateSelectedImagesList() {
                const listDiv = document.getElementById('selected-images-list');
                listDiv.innerHTML = '';
                
                selectedWikimediaImages.forEach((image, index) => {
                  const imgItem = document.createElement('div');
                  imgItem.style.display = 'flex';
                  imgItem.style.alignItems = 'center';
                  imgItem.style.margin = '5px 0';
                  imgItem.style.padding = '5px';
                  imgItem.style.background = 'white';
                  imgItem.style.borderRadius = '4px';
                  imgItem.innerHTML = '
                    <span style="flex: 1; font-size: 12px;">' + image.replace('File:', '') + '</span>
                    <button onclick="removeWikimediaImage(' + index + ')" style="margin-left: 10px; padding: 2px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; font-size: 12px;">Thoir air falbh</button>
                  ';
                  listDiv.appendChild(imgItem);
                });
                
                if (selectedWikimediaImages.length === 0) {
                  listDiv.innerHTML = '<p style="margin: 0; font-style: italic; color: #666;">Cha deach dealbh a thaghadh fhathast</p>';
                }
              }
              
              // Load existing images on render
              if ('{wikimedia_commons}' && '{wikimedia_commons}' !== 'undefined') {
                selectedWikimediaImages = '{wikimedia_commons}'.split(',').map(img => img.trim()).filter(img => img);
                updateSelectedImagesList();
              }
            </script>`
          },
          "freeform": {
            "key": "wikimedia_commons"
          }
        },
        {
          "id": "poi-url",
          "question": { 
            "en": "Add a website URL",
            "gd": "Cuir URL l√†rach-l√¨n ris"
          },
          "freeform": { "key": "website" },
          "render": { 
            "en": "<strong>Website:</strong> <a href='{website}' target='_blank' rel='noopener'>{website}</a>",
            "gd": "<strong>L√†rach-l√¨n:</strong> <a href='{website}' target='_blank' rel='noopener'>{website}</a>"
          },
          "questionHint": {
            "en": "Enter a website URL (e.g., https://example.com)",
            "gd": "Cuir a-steach URL l√†rach-l√¨n (m.e., https://example.com)"
          }
        },
        {
          "id": "poi-url-2",
          "question": { 
            "en": "Add another website URL",
            "gd": "Cuir URL l√†rach-l√¨n eile ris"
          },
          "freeform": { "key": "contact:website" },
          "render": { 
            "en": "<strong>Website 2:</strong> <a href='{contact:website}' target='_blank' rel='noopener'>{contact:website}</a>",
            "gd": "<strong>L√†rach-l√¨n 2:</strong> <a href='{contact:website}' target='_blank' rel='noopener'>{contact:website}</a>"
          },
          "condition": "website~*"
        },
        {
          "id": "poi-url-3",
          "question": { 
            "en": "Add another website URL",
            "gd": "Cuir URL l√†rach-l√¨n eile ris"
          },
          "freeform": { "key": "url" },
          "render": { 
            "en": "<strong>Website 3:</strong> <a href='{url}' target='_blank' rel='noopener'>{url}</a>",
            "gd": "<strong>L√†rach-l√¨n 3:</strong> <a href='{url}' target='_blank' rel='noopener'>{url}</a>"
          },
          "condition": "contact:website~*"
        },
        {
          "id": "poi-url-4",
          "question": { 
            "en": "Add another website URL",
            "gd": "Cuir URL l√†rach-l√¨n eile ris"
          },
          "freeform": { "key": "source:url" },
          "render": { 
            "en": "<strong>Website 4:</strong> <a href='{source:url}' target='_blank' rel='noopener'>{source:url}</a>",
            "gd": "<strong>L√†rach-l√¨n 4:</strong> <a href='{source:url}' target='_blank' rel='noopener'>{source:url}</a>"
          },
          "condition": "url~*"
        },
        {
          "id": "poi-url-5",
          "question": { 
            "en": "Add another website URL",
            "gd": "Cuir URL l√†rach-l√¨n eile ris"
          },
          "freeform": { "key": "ref:url" },
          "render": { 
            "en": "<strong>Website 5:</strong> <a href='{ref:url}' target='_blank' rel='noopener'>{ref:url}</a>",
            "gd": "<strong>L√†rach-l√¨n 5:</strong> <a href='{ref:url}' target='_blank' rel='noopener'>{ref:url}</a>"
          },
          "condition": "source:url~*"
        },
        {
          "id": "poi-tags",
          "question": { 
            "en": "Add tags (e.g. geology, nature)",
            "gd": "Cuir tagaichean ris (m.e. ge√≤las, n√†dar)"
          },
          "freeform": { "key": "tags" },
          "render": { 
            "en": "<strong>Tags:</strong> {tags}",
            "gd": "<strong>Tagaichean:</strong> {tags}"
          }
        }
      ],
      "presets": [
        {
          "title": { 
            "en": "Add Point of Interest",
            "gd": "Cuir Puing √ôidh Ris"
          },
          "tags": ["atlas_poi=yes", "name="],
          "description": { 
            "en": "Add a new point of interest to the map",
            "gd": "Cuir puing √πidh √πr ris a' mhapa"
          },
          "snapToLayer": [],
          "maxSnapDistance": 0
        }
      ]
    }
  ]
}
